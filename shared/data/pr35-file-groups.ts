import { FileGroup, FileChange } from '../types/PRFileTypes';

export const pr35FileGroups: FileGroup[] = [
  {
    id: 'dtos',
    name: 'GitHub PR Comment DTOs & Data Models',
    reviewed: false,
    files: [
      { path: 'src/main/java/com/sonar/dto/GitHubPrReviewCommentDto.java' },
      { path: 'src/main/java/com/sonar/dto/PostPrReviewCommentRequestDto.java' },
      { path: 'src/main/java/com/sonar/dto/package-info.java' },
    ]
  },
  {
    id: 'client-service',
    name: 'GitHub Client Implementation & Service Logic',
    reviewed: false,
    files: [
      { path: 'src/main/java/com/sonar/client/GitHubPrClient.java' },
      { path: 'src/main/java/com/sonar/service/GitHubPrCommentServiceImpl.java' },
      { path: 'src/main/java/com/sonar/service/GitHubPrCommentService.java' },
      { path: 'src/main/java/com/sonar/config/GitHubConfig.java' },
    ]
  },
  {
    id: 'tests',
    name: 'GitHub Client Tests & Mock Implementation',
    reviewed: false,
    files: [
      { path: 'src/test/java/com/sonar/client/GitHubPrClientTest.java' },
      { path: 'src/test/java/com/sonar/service/GitHubPrCommentServiceImplTest.java' },
      { path: 'src/test/java/com/sonar/mock/MockGitHubClient.java' },
      { path: 'src/test/java/com/sonar/deprecated/OldMockServiceTest.java', deleted: true },
      { path: 'src/test/java/com/sonar/deprecated/OldFactoryTest.java', deleted: true },
      { path: 'src/test/java/com/sonar/deprecated/DeprecatedClientTest.java', deleted: true },
    ]
  },
  {
    id: 'pr-info',
    name: 'PR Info Resolution Service Layer',
    reviewed: false,
    files: [
      { path: 'src/main/java/com/sonar/service/PrInfoResolutionService.java' },
      { path: 'src/main/java/com/sonar/service/PrInfoResolutionServiceImpl.java' },
      { path: 'src/main/java/com/sonar/dto/PrInfoResponseDto.java' },
    ]
  },
  {
    id: 'analysis',
    name: 'Analysis Service & SCM Webhook Processing',
    reviewed: false,
    files: [
      { path: 'src/main/java/com/sonar/analysis/AnalysisService.java' },
      { path: 'src/main/java/com/sonar/analysis/AnalysisServiceImpl.java' },
      { path: 'src/main/java/com/sonar/webhook/ScmWebhookProcessor.java' },
      { path: 'src/main/java/com/sonar/webhook/WebhookEventHandler.java' },
      { path: 'src/test/java/com/sonar/analysis/AnalysisServiceTest.java' },
      { path: 'src/test/java/com/sonar/webhook/ScmWebhookProcessorTest.java' },
    ]
  },
  {
    id: 'integration',
    name: 'Integration Tests & E2E Workflow Tests',
    reviewed: false,
    files: [
      { path: 'src/test/java/com/sonar/integration/GitHubIntegrationTest.java' },
      { path: 'src/test/java/com/sonar/integration/E2EWorkflowTest.java' },
      { path: 'src/test/java/com/sonar/integration/PrReviewFlowTest.java' },
      { path: 'src/test/resources/test-data/pr-review-response.json' },
      { path: 'src/test/resources/test-data/webhook-payload.json' },
    ]
  },
];

export const pr35FileChanges: FileChange[] = [
  {
    groupId: 'dtos',
    groupName: 'GitHub PR Comment DTOs & Data Models',
    fileCount: 3,
    additions: 156,
    deletions: 0,
    needsReview: true,
    description: 'Added data transfer objects for GitHub PR review comments API integration. These DTOs handle the serialization/deserialization of GitHub API responses and requests for posting review comments on pull requests.',
    reviewFocus: 'Verify proper JSON mapping annotations, null safety handling, and data validation. Ensure DTOs correctly match GitHub API v3 response format for PR review comments.',
    files: [
      {
        filename: 'src/main/java/io/sonarcloud/github/dto/GitHubPrReviewCommentDto.java',
        additions: 87,
        deletions: 0,
        coverage: 85,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: '@@ -0,0 +1,87 @@', type: 'header', content: '@@ -0,0 +1,87 @@' },
          { lineNumber: 1, type: 'add', content: 'package com.sonar.dto;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import com.fasterxml.jackson.annotation.JsonProperty;' },
          { lineNumber: 4, type: 'add', content: 'import java.time.Instant;' },
          { lineNumber: 5, type: 'add', content: '' },
          { lineNumber: 6, type: 'add', content: '/**' },
          { lineNumber: 7, type: 'add', content: ' * DTO for GitHub PR review comment API response' },
          { lineNumber: 8, type: 'add', content: ' */' },
          { lineNumber: 9, type: 'add', content: 'public class GitHubPrReviewCommentDto {' },
          { lineNumber: 10, type: 'add', content: '' },
          { lineNumber: 11, type: 'add', content: '  @JsonProperty("id")' },
          { lineNumber: 12, type: 'add', content: '  private Long id;' },
          { lineNumber: 13, type: 'add', content: '' },
          { lineNumber: 14, type: 'add', content: '  @JsonProperty("body")' },
          { lineNumber: 15, type: 'add', content: '  private String body;' },
          { lineNumber: 16, type: 'add', content: '' },
          { lineNumber: 17, type: 'add', content: '  @JsonProperty("path")' },
          { lineNumber: 18, type: 'add', content: '  private String path;' },
          { lineNumber: 19, type: 'add', content: '' },
          { lineNumber: 20, type: 'add', content: '  @JsonProperty("position")' },
          { lineNumber: 21, type: 'add', content: '  private Integer position;' },
          { lineNumber: 22, type: 'add', content: '' },
          { lineNumber: 23, type: 'add', content: '  @JsonProperty("created_at")' },
          { lineNumber: 24, type: 'add', content: '  private Instant createdAt;' },
          { lineNumber: 25, type: 'add', content: '' },
          { lineNumber: 26, type: 'add', content: '  // Getters and setters...' },
          { lineNumber: 27, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/main/java/io/sonarcloud/github/dto/PostPrReviewCommentRequestDto.java',
        additions: 54,
        deletions: 0,
        coverage: 92,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: '@@ -0,0 +1,54 @@', type: 'header', content: '@@ -0,0 +1,54 @@' },
          { lineNumber: 1, type: 'add', content: 'package com.sonar.dto;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import com.fasterxml.jackson.annotation.JsonProperty;' },
          { lineNumber: 4, type: 'add', content: '' },
          { lineNumber: 5, type: 'add', content: '/**' },
          { lineNumber: 6, type: 'add', content: ' * Request DTO for posting PR review comments to GitHub' },
          { lineNumber: 7, type: 'add', content: ' */' },
          { lineNumber: 8, type: 'add', content: 'public class PostPrReviewCommentRequestDto {' },
          { lineNumber: 9, type: 'add', content: '' },
          { lineNumber: 10, type: 'add', content: '  @JsonProperty("body")' },
          { lineNumber: 11, type: 'add', content: '  private String body;' },
          { lineNumber: 12, type: 'add', content: '' },
          { lineNumber: 13, type: 'add', content: '  @JsonProperty("commit_id")' },
          { lineNumber: 14, type: 'add', content: '  private String commitId;' },
          { lineNumber: 15, type: 'add', content: '' },
          { lineNumber: 16, type: 'add', content: '  @JsonProperty("path")' },
          { lineNumber: 17, type: 'add', content: '  private String path;' },
          { lineNumber: 18, type: 'add', content: '' },
          { lineNumber: 19, type: 'add', content: '  @JsonProperty("position")' },
          { lineNumber: 20, type: 'add', content: '  private Integer position;' },
          { lineNumber: 21, type: 'add', content: '' },
          { lineNumber: 22, type: 'add', content: '  // Constructor, getters, setters...' },
          { lineNumber: 23, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/main/java/io/sonarcloud/github/dto/package-info.java',
        additions: 15,
        deletions: 0,
        coverage: 100,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: '@@ -0,0 +1,15 @@', type: 'header', content: '@@ -0,0 +1,15 @@' },
          { lineNumber: 1, type: 'add', content: '/**' },
          { lineNumber: 2, type: 'add', content: ' * Data Transfer Objects (DTOs) for GitHub API integration.' },
          { lineNumber: 3, type: 'add', content: ' * ' },
          { lineNumber: 4, type: 'add', content: ' * This package contains DTOs for:' },
          { lineNumber: 5, type: 'add', content: ' * - GitHub PR review comments (read operations)' },
          { lineNumber: 6, type: 'add', content: ' * - GitHub PR review comment requests (write operations)' },
          { lineNumber: 7, type: 'add', content: ' * ' },
          { lineNumber: 8, type: 'add', content: ' * All DTOs use Jackson annotations for JSON serialization.' },
          { lineNumber: 9, type: 'add', content: ' */' },
          { lineNumber: 10, type: 'add', content: 'package com.sonar.dto;' },
        ],
        expanded: false,
        checked: false
      },
    ]
  },
  {
    groupId: 'client-service',
    groupName: 'GitHub Client Implementation & Service Logic',
    fileCount: 4,
    additions: 287,
    deletions: 12,
    needsReview: true,
    description: 'Implemented GitHub client and service layer for PR comment operations. The client handles HTTP communication with GitHub API, while the service layer provides business logic for comment posting.',
    reviewFocus: 'Check error handling, retry logic, rate limiting, and proper use of GitHub API authentication. Verify service methods are properly transactional.',
    files: [
      {
        filename: 'src/main/java/io/sonarcloud/github/client/GitHubPrClient.java',
        additions: 134,
        deletions: 5,
        coverage: 78,
        duplications: 0,
        issues: 1,
        changes: [
          { lineNumber: '@@ -15,8 +15,20 @@', type: 'header', content: '@@ -15,8 +15,20 @@ public class GitHubPrClient {' },
          { lineNumber: 15, type: 'context', content: '  private static final String GITHUB_API_BASE = "https://api.github.com";' },
          { lineNumber: 16, type: 'context', content: '  private final RestTemplate restTemplate;' },
          { lineNumber: 17, type: 'delete', content: '  private final String token;' },
          { lineNumber: 18, type: 'add', content: '  private final String authToken;' },
          { lineNumber: 19, type: 'add', content: '  private final RateLimitHandler rateLimitHandler;' },
          { lineNumber: 20, type: 'context', content: '' },
          { lineNumber: 21, type: 'add', content: '  public GitHubPrClient(RestTemplate restTemplate, String authToken, RateLimitHandler rateLimitHandler) {' },
          { lineNumber: 22, type: 'add', content: '    this.restTemplate = restTemplate;' },
          { lineNumber: 23, type: 'add', content: '    this.authToken = authToken;' },
          { lineNumber: 24, type: 'add', content: '    this.rateLimitHandler = rateLimitHandler;' },
          { lineNumber: 25, type: 'add', content: '  }' },
          { lineNumber: '@@ -45,6 +57,18 @@', type: 'header', content: '@@ -45,6 +57,18 @@ public ResponseEntity<GitHubPrReviewCommentDto> postComment(' },
          { lineNumber: 57, type: 'add', content: '    // Check rate limit before making request' },
          { lineNumber: 58, type: 'add', content: '    if (rateLimitHandler.isRateLimited()) {' },
          { lineNumber: 59, type: 'add', content: '      throw new RateLimitExceededException("GitHub API rate limit exceeded");' },
          { lineNumber: 60, type: 'add', content: '    }' },
          { lineNumber: 61, type: 'add', content: '' },
          { lineNumber: 62, type: 'context', content: '    HttpHeaders headers = new HttpHeaders();' },
          { lineNumber: 63, type: 'delete', content: '    headers.setBearerAuth(token);' },
          { lineNumber: 64, type: 'add', content: '    headers.setBearerAuth(authToken);' },
          { lineNumber: 65, type: 'context', content: '    headers.setContentType(MediaType.APPLICATION_JSON);' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/main/java/io/sonarcloud/github/service/GitHubPrCommentServiceImpl.java',
        additions: 98,
        deletions: 4,
        coverage: 88,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 12, type: 'context', content: 'public class GitHubPrCommentServiceImpl implements GitHubPrCommentService {' },
          { lineNumber: 13, type: 'context', content: '' },
          { lineNumber: 14, type: 'context', content: '  private final GitHubPrClient client;' },
          { lineNumber: 15, type: 'add', content: '  private final CommentValidator validator;' },
          { lineNumber: 16, type: 'add', content: '  private final MetricsService metricsService;' },
          { lineNumber: 17, type: 'context', content: '' },
          { lineNumber: 18, type: 'delete', content: '  public GitHubPrCommentServiceImpl(GitHubPrClient client) {' },
          { lineNumber: 19, type: 'add', content: '  public GitHubPrCommentServiceImpl(GitHubPrClient client, CommentValidator validator, MetricsService metricsService) {' },
          { lineNumber: 20, type: 'context', content: '    this.client = client;' },
          { lineNumber: 21, type: 'add', content: '    this.validator = validator;' },
          { lineNumber: 22, type: 'add', content: '    this.metricsService = metricsService;' },
          { lineNumber: 23, type: 'context', content: '  }' },
          { lineNumber: 24, type: 'context', content: '' },
          { lineNumber: 25, type: 'context', content: '  @Override' },
          { lineNumber: 26, type: 'add', content: '  @Transactional' },
          { lineNumber: 27, type: 'context', content: '  public GitHubPrReviewCommentDto postComment(String owner, String repo, int prNumber, PostPrReviewCommentRequestDto request) {' },
          { lineNumber: 28, type: 'add', content: '    // Validate comment before posting' },
          { lineNumber: 29, type: 'add', content: '    validator.validate(request);' },
          { lineNumber: 30, type: 'add', content: '    ' },
          { lineNumber: 31, type: 'add', content: '    long startTime = System.currentTimeMillis();' },
          { lineNumber: 32, type: 'context', content: '    try {' },
          { lineNumber: 33, type: 'delete', content: '      return client.postComment(owner, repo, prNumber, request).getBody();' },
          { lineNumber: 34, type: 'add', content: '      ResponseEntity<GitHubPrReviewCommentDto> response = client.postComment(owner, repo, prNumber, request);' },
          { lineNumber: 35, type: 'add', content: '      metricsService.recordCommentPost(System.currentTimeMillis() - startTime, true);' },
          { lineNumber: 36, type: 'add', content: '      return response.getBody();' },
          { lineNumber: 37, type: 'context', content: '    } catch (Exception e) {' },
          { lineNumber: 38, type: 'add', content: '      metricsService.recordCommentPost(System.currentTimeMillis() - startTime, false);' },
          { lineNumber: 39, type: 'delete', content: '      throw new CommentPostException("Failed to post comment", e);' },
          { lineNumber: 40, type: 'add', content: '      throw new CommentPostException("Failed to post comment to PR #" + prNumber, e);' },
          { lineNumber: 41, type: 'context', content: '    }' },
          { lineNumber: 42, type: 'context', content: '  }' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/main/java/io/sonarcloud/github/service/GitHubPrCommentService.java',
        additions: 32,
        deletions: 0,
        coverage: 100,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.service;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import com.sonar.dto.GitHubPrReviewCommentDto;' },
          { lineNumber: 4, type: 'add', content: 'import com.sonar.dto.PostPrReviewCommentRequestDto;' },
          { lineNumber: 5, type: 'add', content: '' },
          { lineNumber: 6, type: 'add', content: '/**' },
          { lineNumber: 7, type: 'add', content: ' * Service interface for GitHub PR comment operations' },
          { lineNumber: 8, type: 'add', content: ' */' },
          { lineNumber: 9, type: 'add', content: 'public interface GitHubPrCommentService {' },
          { lineNumber: 10, type: 'add', content: '' },
          { lineNumber: 11, type: 'add', content: '  /**' },
          { lineNumber: 12, type: 'add', content: '   * Post a review comment to a GitHub pull request' },
          { lineNumber: 13, type: 'add', content: '   * ' },
          { lineNumber: 14, type: 'add', content: '   * @param owner Repository owner' },
          { lineNumber: 15, type: 'add', content: '   * @param repo Repository name' },
          { lineNumber: 16, type: 'add', content: '   * @param prNumber Pull request number' },
          { lineNumber: 17, type: 'add', content: '   * @param request Comment request data' },
          { lineNumber: 18, type: 'add', content: '   * @return Posted comment response' },
          { lineNumber: 19, type: 'add', content: '   */' },
          { lineNumber: 20, type: 'add', content: '  GitHubPrReviewCommentDto postComment(String owner, String repo, int prNumber, PostPrReviewCommentRequestDto request);' },
          { lineNumber: 21, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/main/java/io/sonarcloud/github/config/GitHubConfig.java',
        additions: 23,
        deletions: 3,
        coverage: 95,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 18, type: 'context', content: '@Configuration' },
          { lineNumber: 19, type: 'context', content: 'public class GitHubConfig {' },
          { lineNumber: 20, type: 'context', content: '' },
          { lineNumber: 21, type: 'delete', content: '  @Value("${github.token}")' },
          { lineNumber: 22, type: 'add', content: '  @Value("${github.auth.token}")' },
          { lineNumber: 23, type: 'context', content: '  private String githubToken;' },
          { lineNumber: 24, type: 'context', content: '' },
          { lineNumber: 25, type: 'add', content: '  @Value("${github.api.timeout:5000}")' },
          { lineNumber: 26, type: 'add', content: '  private int apiTimeout;' },
          { lineNumber: 27, type: 'add', content: '' },
          { lineNumber: 28, type: 'context', content: '  @Bean' },
          { lineNumber: 29, type: 'delete', content: '  public GitHubPrClient gitHubPrClient(RestTemplate restTemplate) {' },
          { lineNumber: 30, type: 'delete', content: '    return new GitHubPrClient(restTemplate, githubToken);' },
          { lineNumber: 31, type: 'add', content: '  public GitHubPrClient gitHubPrClient(RestTemplate restTemplate, RateLimitHandler rateLimitHandler) {' },
          { lineNumber: 32, type: 'add', content: '    return new GitHubPrClient(restTemplate, githubToken, rateLimitHandler);' },
          { lineNumber: 33, type: 'context', content: '  }' },
          { lineNumber: 34, type: 'add', content: '' },
          { lineNumber: 35, type: 'add', content: '  @Bean' },
          { lineNumber: 36, type: 'add', content: '  public RateLimitHandler rateLimitHandler() {' },
          { lineNumber: 37, type: 'add', content: '    return new RateLimitHandler();' },
          { lineNumber: 38, type: 'add', content: '  }' },
        ],
        expanded: false,
        checked: false
      },
    ]
  },
  {
    groupId: 'tests',
    groupName: 'GitHub Client Tests & Mock Implementation',
    fileCount: 6,
    additions: 423,
    deletions: 189,
    needsReview: true,
    description: 'Added comprehensive test coverage for GitHub client and service layer. Includes unit tests with mocked GitHub API responses and updated mock implementations. Removed deprecated test files.',
    reviewFocus: 'Ensure test coverage is adequate, mock implementations are realistic, and deleted deprecated tests are no longer referenced.',
    files: [
      {
        filename: 'src/test/java/io/sonarcloud/github/client/GitHubPrClientTest.java',
        additions: 187,
        deletions: 0,
        coverage: 100,
        duplications: 5,
        issues: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.client;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import org.junit.jupiter.api.BeforeEach;' },
          { lineNumber: 4, type: 'add', content: 'import org.junit.jupiter.api.Test;' },
          { lineNumber: 5, type: 'add', content: 'import org.mockito.Mock;' },
          { lineNumber: 6, type: 'add', content: 'import org.springframework.web.client.RestTemplate;' },
          { lineNumber: 7, type: 'add', content: '' },
          { lineNumber: 8, type: 'add', content: 'import static org.junit.jupiter.api.Assertions.*;' },
          { lineNumber: 9, type: 'add', content: 'import static org.mockito.Mockito.*;' },
          { lineNumber: 10, type: 'add', content: '' },
          { lineNumber: 11, type: 'add', content: 'class GitHubPrClientTest {' },
          { lineNumber: 12, type: 'add', content: '' },
          { lineNumber: 13, type: 'add', content: '  @Mock' },
          { lineNumber: 14, type: 'add', content: '  private RestTemplate restTemplate;' },
          { lineNumber: 15, type: 'add', content: '' },
          { lineNumber: 16, type: 'add', content: '  @Mock' },
          { lineNumber: 17, type: 'add', content: '  private RateLimitHandler rateLimitHandler;' },
          { lineNumber: 18, type: 'add', content: '' },
          { lineNumber: 19, type: 'add', content: '  private GitHubPrClient client;' },
          { lineNumber: 20, type: 'add', content: '' },
          { lineNumber: 21, type: 'add', content: '  @BeforeEach' },
          { lineNumber: 22, type: 'add', content: '  void setUp() {' },
          { lineNumber: 23, type: 'add', content: '    client = new GitHubPrClient(restTemplate, "test-token", rateLimitHandler);' },
          { lineNumber: 24, type: 'add', content: '  }' },
          { lineNumber: 25, type: 'add', content: '' },
          { lineNumber: 26, type: 'add', content: '  @Test' },
          { lineNumber: 27, type: 'add', content: '  void testPostComment_Success() {' },
          { lineNumber: 28, type: 'add', content: '    // Test implementation...' },
          { lineNumber: 29, type: 'add', content: '  }' },
          { lineNumber: 30, type: 'add', content: '' },
          { lineNumber: 31, type: 'add', content: '  @Test' },
          { lineNumber: 32, type: 'add', content: '  void testPostComment_RateLimited() {' },
          { lineNumber: 33, type: 'add', content: '    when(rateLimitHandler.isRateLimited()).thenReturn(true);' },
          { lineNumber: 34, type: 'add', content: '    assertThrows(RateLimitExceededException.class, () -> {' },
          { lineNumber: 35, type: 'add', content: '      client.postComment("owner", "repo", 123, new PostPrReviewCommentRequestDto());' },
          { lineNumber: 36, type: 'add', content: '    });' },
          { lineNumber: 37, type: 'add', content: '  }' },
          { lineNumber: 38, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/test/java/io/sonarcloud/github/service/GitHubPrCommentServiceImplTest.java',
        additions: 154,
        deletions: 0,
        coverage: 100,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.service;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import com.sonar.client.GitHubPrClient;' },
          { lineNumber: 4, type: 'add', content: 'import com.sonar.dto.PostPrReviewCommentRequestDto;' },
          { lineNumber: 5, type: 'add', content: 'import org.junit.jupiter.api.Test;' },
          { lineNumber: 6, type: 'add', content: 'import org.junit.jupiter.api.extension.ExtendWith;' },
          { lineNumber: 7, type: 'add', content: 'import org.mockito.InjectMocks;' },
          { lineNumber: 8, type: 'add', content: 'import org.mockito.Mock;' },
          { lineNumber: 9, type: 'add', content: 'import org.mockito.junit.jupiter.MockitoExtension;' },
          { lineNumber: 10, type: 'add', content: '' },
          { lineNumber: 11, type: 'add', content: 'import static org.mockito.ArgumentMatchers.*;' },
          { lineNumber: 12, type: 'add', content: 'import static org.mockito.Mockito.*;' },
          { lineNumber: 13, type: 'add', content: '' },
          { lineNumber: 14, type: 'add', content: '@ExtendWith(MockitoExtension.class)' },
          { lineNumber: 15, type: 'add', content: 'class GitHubPrCommentServiceImplTest {' },
          { lineNumber: 16, type: 'add', content: '' },
          { lineNumber: 17, type: 'add', content: '  @Mock' },
          { lineNumber: 18, type: 'add', content: '  private GitHubPrClient client;' },
          { lineNumber: 19, type: 'add', content: '' },
          { lineNumber: 20, type: 'add', content: '  @Mock' },
          { lineNumber: 21, type: 'add', content: '  private CommentValidator validator;' },
          { lineNumber: 22, type: 'add', content: '' },
          { lineNumber: 23, type: 'add', content: '  @Mock' },
          { lineNumber: 24, type: 'add', content: '  private MetricsService metricsService;' },
          { lineNumber: 25, type: 'add', content: '' },
          { lineNumber: 26, type: 'add', content: '  @InjectMocks' },
          { lineNumber: 27, type: 'add', content: '  private GitHubPrCommentServiceImpl service;' },
          { lineNumber: 28, type: 'add', content: '' },
          { lineNumber: 29, type: 'add', content: '  @Test' },
          { lineNumber: 30, type: 'add', content: '  void testPostComment_ValidatesInput() {' },
          { lineNumber: 31, type: 'add', content: '    PostPrReviewCommentRequestDto request = new PostPrReviewCommentRequestDto();' },
          { lineNumber: 32, type: 'add', content: '    service.postComment("owner", "repo", 42, request);' },
          { lineNumber: 33, type: 'add', content: '    verify(validator).validate(request);' },
          { lineNumber: 34, type: 'add', content: '  }' },
          { lineNumber: 35, type: 'add', content: '' },
          { lineNumber: 36, type: 'add', content: '  @Test' },
          { lineNumber: 37, type: 'add', content: '  void testPostComment_RecordsMetrics() {' },
          { lineNumber: 38, type: 'add', content: '    // Test metrics recording...' },
          { lineNumber: 39, type: 'add', content: '    verify(metricsService).recordCommentPost(anyLong(), eq(true));' },
          { lineNumber: 40, type: 'add', content: '  }' },
          { lineNumber: 41, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/test/java/io/sonarcloud/github/client/MockGitHubClient.java',
        additions: 82,
        deletions: 0,
        coverage: 100,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.mock;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import com.sonar.client.GitHubPrClient;' },
          { lineNumber: 4, type: 'add', content: 'import com.sonar.dto.GitHubPrReviewCommentDto;' },
          { lineNumber: 5, type: 'add', content: 'import com.sonar.dto.PostPrReviewCommentRequestDto;' },
          { lineNumber: 6, type: 'add', content: 'import org.springframework.http.ResponseEntity;' },
          { lineNumber: 7, type: 'add', content: '' },
          { lineNumber: 8, type: 'add', content: '/**' },
          { lineNumber: 9, type: 'add', content: ' * Mock implementation of GitHubPrClient for testing' },
          { lineNumber: 10, type: 'add', content: ' */' },
          { lineNumber: 11, type: 'add', content: 'public class MockGitHubClient extends GitHubPrClient {' },
          { lineNumber: 12, type: 'add', content: '' },
          { lineNumber: 13, type: 'add', content: '  private boolean shouldFail = false;' },
          { lineNumber: 14, type: 'add', content: '  private int callCount = 0;' },
          { lineNumber: 15, type: 'add', content: '' },
          { lineNumber: 16, type: 'add', content: '  public MockGitHubClient() {' },
          { lineNumber: 17, type: 'add', content: '    super(null, "mock-token", null);' },
          { lineNumber: 18, type: 'add', content: '  }' },
          { lineNumber: 19, type: 'add', content: '' },
          { lineNumber: 20, type: 'add', content: '  @Override' },
          { lineNumber: 21, type: 'add', content: '  public ResponseEntity<GitHubPrReviewCommentDto> postComment(' },
          { lineNumber: 22, type: 'add', content: '      String owner, String repo, int prNumber, PostPrReviewCommentRequestDto request) {' },
          { lineNumber: 23, type: 'add', content: '    callCount++;' },
          { lineNumber: 24, type: 'add', content: '    if (shouldFail) {' },
          { lineNumber: 25, type: 'add', content: '      throw new RuntimeException("Mock failure");' },
          { lineNumber: 26, type: 'add', content: '    }' },
          { lineNumber: 27, type: 'add', content: '    GitHubPrReviewCommentDto response = new GitHubPrReviewCommentDto();' },
          { lineNumber: 28, type: 'add', content: '    response.setId(12345L);' },
          { lineNumber: 29, type: 'add', content: '    response.setBody(request.getBody());' },
          { lineNumber: 30, type: 'add', content: '    return ResponseEntity.ok(response);' },
          { lineNumber: 31, type: 'add', content: '  }' },
          { lineNumber: 32, type: 'add', content: '' },
          { lineNumber: 33, type: 'add', content: '  public void setShouldFail(boolean shouldFail) {' },
          { lineNumber: 34, type: 'add', content: '    this.shouldFail = shouldFail;' },
          { lineNumber: 35, type: 'add', content: '  }' },
          { lineNumber: 36, type: 'add', content: '' },
          { lineNumber: 37, type: 'add', content: '  public int getCallCount() {' },
          { lineNumber: 38, type: 'add', content: '    return callCount;' },
          { lineNumber: 39, type: 'add', content: '  }' },
          { lineNumber: 40, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      { filename: 'src/test/java/io/sonarcloud/github/service/OldMockServiceTest.java', additions: 0, deletions: 67, changes: [], expanded: false, checked: false },
      { filename: 'src/test/java/io/sonarcloud/github/factory/OldFactoryTest.java', additions: 0, deletions: 54, changes: [], expanded: false, checked: false },
      { filename: 'src/test/java/io/sonarcloud/github/client/DeprecatedClientTest.java', additions: 0, deletions: 68, changes: [], expanded: false, checked: false },
    ]
  },
  {
    groupId: 'pr-info',
    groupName: 'PR Info Resolution Service Layer',
    fileCount: 3,
    additions: 198,
    deletions: 0,
    needsReview: true,
    description: 'Created service layer for resolving PR information from various sources (GitHub, local analysis, cache). Consolidates PR metadata retrieval logic.',
    reviewFocus: 'Review caching strategy, error handling for missing PRs, and performance implications of multi-source resolution.',
    files: [
      {
        filename: 'src/main/java/io/sonarcloud/prinfo/PrInfoResolutionService.java',
        additions: 45,
        deletions: 0,
        coverage: 90,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.service;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import com.sonar.dto.PrInfoResponseDto;' },
          { lineNumber: 4, type: 'add', content: 'import java.util.Optional;' },
          { lineNumber: 5, type: 'add', content: '' },
          { lineNumber: 6, type: 'add', content: '/**' },
          { lineNumber: 7, type: 'add', content: ' * Service for resolving PR information from multiple sources' },
          { lineNumber: 8, type: 'add', content: ' */' },
          { lineNumber: 9, type: 'add', content: 'public interface PrInfoResolutionService {' },
          { lineNumber: 10, type: 'add', content: '' },
          { lineNumber: 11, type: 'add', content: '  /**' },
          { lineNumber: 12, type: 'add', content: '   * Resolve PR information by PR number' },
          { lineNumber: 13, type: 'add', content: '   * Checks cache, local analysis data, and GitHub API in order' },
          { lineNumber: 14, type: 'add', content: '   */' },
          { lineNumber: 15, type: 'add', content: '  Optional<PrInfoResponseDto> resolvePrInfo(String owner, String repo, int prNumber);' },
          { lineNumber: 16, type: 'add', content: '' },
          { lineNumber: 17, type: 'add', content: '  /**' },
          { lineNumber: 18, type: 'add', content: '   * Resolve PR information by commit SHA' },
          { lineNumber: 19, type: 'add', content: '   */' },
          { lineNumber: 20, type: 'add', content: '  Optional<PrInfoResponseDto> resolvePrInfoByCommit(String owner, String repo, String commitSha);' },
          { lineNumber: 21, type: 'add', content: '' },
          { lineNumber: 22, type: 'add', content: '  /**' },
          { lineNumber: 23, type: 'add', content: '   * Invalidate cached PR info' },
          { lineNumber: 24, type: 'add', content: '   */' },
          { lineNumber: 25, type: 'add', content: '  void invalidateCache(String owner, String repo, int prNumber);' },
          { lineNumber: 26, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/main/java/io/sonarcloud/prinfo/PrInfoResolutionServiceImpl.java',
        additions: 112,
        deletions: 0,
        coverage: 84,
        duplications: 0,
        issues: 2,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.service;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import com.sonar.cache.PrInfoCache;' },
          { lineNumber: 4, type: 'add', content: 'import com.sonar.client.GitHubPrClient;' },
          { lineNumber: 5, type: 'add', content: 'import com.sonar.dto.PrInfoResponseDto;' },
          { lineNumber: 6, type: 'add', content: 'import org.slf4j.Logger;' },
          { lineNumber: 7, type: 'add', content: 'import org.slf4j.LoggerFactory;' },
          { lineNumber: 8, type: 'add', content: 'import org.springframework.stereotype.Service;' },
          { lineNumber: 9, type: 'add', content: 'import java.util.Optional;' },
          { lineNumber: 10, type: 'add', content: '' },
          { lineNumber: 11, type: 'add', content: '@Service' },
          { lineNumber: 12, type: 'add', content: 'public class PrInfoResolutionServiceImpl implements PrInfoResolutionService {' },
          { lineNumber: 13, type: 'add', content: '' },
          { lineNumber: 14, type: 'add', content: '  private static final Logger log = LoggerFactory.getLogger(PrInfoResolutionServiceImpl.class);' },
          { lineNumber: 15, type: 'add', content: '' },
          { lineNumber: 16, type: 'add', content: '  private final PrInfoCache cache;' },
          { lineNumber: 17, type: 'add', content: '  private final GitHubPrClient gitHubClient;' },
          { lineNumber: 18, type: 'add', content: '  private final AnalysisDataRepository analysisRepo;' },
          { lineNumber: 19, type: 'add', content: '' },
          { lineNumber: 20, type: 'add', content: '  @Override' },
          { lineNumber: 21, type: 'add', content: '  public Optional<PrInfoResponseDto> resolvePrInfo(String owner, String repo, int prNumber) {' },
          { lineNumber: 22, type: 'add', content: '    // Try cache first' },
          { lineNumber: 23, type: 'add', content: '    Optional<PrInfoResponseDto> cached = cache.get(owner, repo, prNumber);' },
          { lineNumber: 24, type: 'add', content: '    if (cached.isPresent()) {' },
          { lineNumber: 25, type: 'add', content: '      log.debug("PR info found in cache: {}/{} #{}", owner, repo, prNumber);' },
          { lineNumber: 26, type: 'add', content: '      return cached;' },
          { lineNumber: 27, type: 'add', content: '    }' },
          { lineNumber: 28, type: 'add', content: '' },
          { lineNumber: 29, type: 'add', content: '    // Try local analysis data' },
          { lineNumber: 30, type: 'add', content: '    Optional<PrInfoResponseDto> fromAnalysis = analysisRepo.findPrInfo(owner, repo, prNumber);' },
          { lineNumber: 31, type: 'add', content: '    if (fromAnalysis.isPresent()) {' },
          { lineNumber: 32, type: 'add', content: '      cache.put(owner, repo, prNumber, fromAnalysis.get());' },
          { lineNumber: 33, type: 'add', content: '      return fromAnalysis;' },
          { lineNumber: 34, type: 'add', content: '    }' },
          { lineNumber: 35, type: 'add', content: '' },
          { lineNumber: 36, type: 'add', content: '    // Fallback to GitHub API' },
          { lineNumber: 37, type: 'add', content: '    try {' },
          { lineNumber: 38, type: 'add', content: '      PrInfoResponseDto fromGitHub = gitHubClient.getPrInfo(owner, repo, prNumber);' },
          { lineNumber: 39, type: 'add', content: '      cache.put(owner, repo, prNumber, fromGitHub);' },
          { lineNumber: 40, type: 'add', content: '      return Optional.of(fromGitHub);' },
          { lineNumber: 41, type: 'add', content: '    } catch (Exception e) {' },
          { lineNumber: 42, type: 'add', content: '      log.error("Failed to fetch PR info from GitHub", e);' },
          { lineNumber: 43, type: 'add', content: '      return Optional.empty();' },
          { lineNumber: 44, type: 'add', content: '    }' },
          { lineNumber: 45, type: 'add', content: '  }' },
          { lineNumber: 46, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/main/java/io/sonarcloud/prinfo/dto/PrInfoResponseDto.java',
        additions: 41,
        deletions: 0,
        coverage: 100,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.dto;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import com.fasterxml.jackson.annotation.JsonProperty;' },
          { lineNumber: 4, type: 'add', content: '' },
          { lineNumber: 5, type: 'add', content: '/**' },
          { lineNumber: 6, type: 'add', content: ' * DTO for PR information response' },
          { lineNumber: 7, type: 'add', content: ' */' },
          { lineNumber: 8, type: 'add', content: 'public class PrInfoResponseDto {' },
          { lineNumber: 9, type: 'add', content: '' },
          { lineNumber: 10, type: 'add', content: '  @JsonProperty("pr_number")' },
          { lineNumber: 11, type: 'add', content: '  private int prNumber;' },
          { lineNumber: 12, type: 'add', content: '' },
          { lineNumber: 13, type: 'add', content: '  @JsonProperty("title")' },
          { lineNumber: 14, type: 'add', content: '  private String title;' },
          { lineNumber: 15, type: 'add', content: '' },
          { lineNumber: 16, type: 'add', content: '  @JsonProperty("author")' },
          { lineNumber: 17, type: 'add', content: '  private String author;' },
          { lineNumber: 18, type: 'add', content: '' },
          { lineNumber: 19, type: 'add', content: '  @JsonProperty("base_branch")' },
          { lineNumber: 20, type: 'add', content: '  private String baseBranch;' },
          { lineNumber: 21, type: 'add', content: '' },
          { lineNumber: 22, type: 'add', content: '  @JsonProperty("head_branch")' },
          { lineNumber: 23, type: 'add', content: '  private String headBranch;' },
          { lineNumber: 24, type: 'add', content: '' },
          { lineNumber: 25, type: 'add', content: '  @JsonProperty("state")' },
          { lineNumber: 26, type: 'add', content: '  private String state;' },
          { lineNumber: 27, type: 'add', content: '' },
          { lineNumber: 28, type: 'add', content: '  // Getters and setters...' },
          { lineNumber: 29, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
    ]
  },
  {
    groupId: 'analysis',
    groupName: 'Analysis Service & SCM Webhook Processing',
    fileCount: 6,
    additions: 512,
    deletions: 45,
    needsReview: true,
    description: 'Enhanced analysis service to integrate with SCM webhooks. Added webhook processing for PR events and automated triggering of analysis on PR updates.',
    reviewFocus: 'Verify webhook signature validation, event filtering logic, and proper async processing. Check for race conditions in analysis triggering.',
    files: [
      {
        filename: 'src/main/java/io/sonarcloud/analysis/AnalysisService.java',
        additions: 34,
        deletions: 8,
        coverage: 75,
        duplications: 0,
        issues: 1,
        changes: [
          { lineNumber: 8, type: 'context', content: 'public interface AnalysisService {' },
          { lineNumber: 9, type: 'context', content: '' },
          { lineNumber: 10, type: 'delete', content: '  void runAnalysis(String projectKey);' },
          { lineNumber: 11, type: 'add', content: '  /**' },
          { lineNumber: 12, type: 'add', content: '   * Trigger analysis for a project' },
          { lineNumber: 13, type: 'add', content: '   * @param projectKey Project identifier' },
          { lineNumber: 14, type: 'add', content: '   * @param branch Branch to analyze (optional)' },
          { lineNumber: 15, type: 'add', content: '   */' },
          { lineNumber: 16, type: 'add', content: '  void runAnalysis(String projectKey, String branch);' },
          { lineNumber: 17, type: 'context', content: '' },
          { lineNumber: 18, type: 'add', content: '  /**' },
          { lineNumber: 19, type: 'add', content: '   * Trigger analysis for a PR' },
          { lineNumber: 20, type: 'add', content: '   */' },
          { lineNumber: 21, type: 'add', content: '  void runPrAnalysis(String projectKey, int prNumber);' },
          { lineNumber: 22, type: 'context', content: '' },
          { lineNumber: 23, type: 'delete', content: '  AnalysisStatus getAnalysisStatus(String projectKey);' },
          { lineNumber: 24, type: 'add', content: '  /**' },
          { lineNumber: 25, type: 'add', content: '   * Get analysis status with more details' },
          { lineNumber: 26, type: 'add', content: '   */' },
          { lineNumber: 27, type: 'add', content: '  AnalysisStatusDto getAnalysisStatus(String projectKey, String branch);' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/main/java/io/sonarcloud/analysis/AnalysisServiceImpl.java',
        additions: 87,
        deletions: 12,
        coverage: 82,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 15, type: 'context', content: '@Service' },
          { lineNumber: 16, type: 'context', content: 'public class AnalysisServiceImpl implements AnalysisService {' },
          { lineNumber: 17, type: 'context', content: '' },
          { lineNumber: 18, type: 'delete', content: '  private final AnalysisClient client;' },
          { lineNumber: 19, type: 'add', content: '  private final AnalysisClient analysisClient;' },
          { lineNumber: 20, type: 'add', content: '  private final WebhookEventPublisher eventPublisher;' },
          { lineNumber: 21, type: 'context', content: '' },
          { lineNumber: 22, type: 'context', content: '  @Override' },
          { lineNumber: 23, type: 'delete', content: '  public void runAnalysis(String projectKey) {' },
          { lineNumber: 24, type: 'delete', content: '    client.triggerAnalysis(projectKey);' },
          { lineNumber: 25, type: 'add', content: '  public void runAnalysis(String projectKey, String branch) {' },
          { lineNumber: 26, type: 'add', content: '    log.info("Starting analysis for project: {}, branch: {}", projectKey, branch);' },
          { lineNumber: 27, type: 'add', content: '    analysisClient.triggerAnalysis(projectKey, branch);' },
          { lineNumber: 28, type: 'add', content: '    eventPublisher.publishAnalysisStarted(projectKey, branch);' },
          { lineNumber: 29, type: 'context', content: '  }' },
          { lineNumber: 30, type: 'context', content: '' },
          { lineNumber: 31, type: 'add', content: '  @Override' },
          { lineNumber: 32, type: 'add', content: '  @Async' },
          { lineNumber: 33, type: 'add', content: '  public void runPrAnalysis(String projectKey, int prNumber) {' },
          { lineNumber: 34, type: 'add', content: '    log.info("Starting PR analysis for project: {}, PR: {}", projectKey, prNumber);' },
          { lineNumber: 35, type: 'add', content: '    try {' },
          { lineNumber: 36, type: 'add', content: '      analysisClient.triggerPrAnalysis(projectKey, prNumber);' },
          { lineNumber: 37, type: 'add', content: '      eventPublisher.publishPrAnalysisStarted(projectKey, prNumber);' },
          { lineNumber: 38, type: 'add', content: '    } catch (Exception e) {' },
          { lineNumber: 39, type: 'add', content: '      log.error("PR analysis failed", e);' },
          { lineNumber: 40, type: 'add', content: '      eventPublisher.publishPrAnalysisFailed(projectKey, prNumber, e);' },
          { lineNumber: 41, type: 'add', content: '    }' },
          { lineNumber: 42, type: 'add', content: '  }' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/main/java/io/sonarcloud/webhook/ScmWebhookProcessor.java',
        additions: 145,
        deletions: 15,
        coverage: 88,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.webhook;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import com.sonar.analysis.AnalysisService;' },
          { lineNumber: 4, type: 'add', content: 'import org.springframework.stereotype.Component;' },
          { lineNumber: 5, type: 'add', content: '' },
          { lineNumber: 6, type: 'add', content: '@Component' },
          { lineNumber: 7, type: 'add', content: 'public class ScmWebhookProcessor {' },
          { lineNumber: 8, type: 'add', content: '' },
          { lineNumber: 9, type: 'add', content: '  private final AnalysisService analysisService;' },
          { lineNumber: 10, type: 'add', content: '  private final WebhookSignatureValidator signatureValidator;' },
          { lineNumber: 11, type: 'add', content: '' },
          { lineNumber: 12, type: 'add', content: '  public void processWebhook(WebhookPayload payload, String signature) {' },
          { lineNumber: 13, type: 'add', content: '    // Validate webhook signature' },
          { lineNumber: 14, type: 'add', content: '    if (!signatureValidator.isValid(payload, signature)) {' },
          { lineNumber: 15, type: 'add', content: '      throw new InvalidWebhookSignatureException("Invalid signature");' },
          { lineNumber: 16, type: 'add', content: '    }' },
          { lineNumber: 17, type: 'add', content: '' },
          { lineNumber: 18, type: 'add', content: '    // Filter relevant events' },
          { lineNumber: 19, type: 'add', content: '    if (!isRelevantEvent(payload)) {' },
          { lineNumber: 20, type: 'add', content: '      log.debug("Ignoring webhook event: {}", payload.getAction());' },
          { lineNumber: 21, type: 'add', content: '      return;' },
          { lineNumber: 22, type: 'add', content: '    }' },
          { lineNumber: 23, type: 'add', content: '' },
          { lineNumber: 24, type: 'add', content: '    // Process PR events' },
          { lineNumber: 25, type: 'add', content: '    if (payload.isPullRequestEvent()) {' },
          { lineNumber: 26, type: 'add', content: '      int prNumber = payload.getPullRequest().getNumber();' },
          { lineNumber: 27, type: 'add', content: '      String projectKey = resolveProjectKey(payload);' },
          { lineNumber: 28, type: 'add', content: '      analysisService.runPrAnalysis(projectKey, prNumber);' },
          { lineNumber: 29, type: 'add', content: '    }' },
          { lineNumber: 30, type: 'add', content: '  }' },
          { lineNumber: 31, type: 'add', content: '' },
          { lineNumber: 32, type: 'add', content: '  private boolean isRelevantEvent(WebhookPayload payload) {' },
          { lineNumber: 33, type: 'add', content: '    return payload.getAction().equals("opened") ||' },
          { lineNumber: 34, type: 'add', content: '           payload.getAction().equals("synchronize") ||' },
          { lineNumber: 35, type: 'add', content: '           payload.getAction().equals("reopened");' },
          { lineNumber: 36, type: 'add', content: '  }' },
          { lineNumber: 37, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/main/java/io/sonarcloud/webhook/WebhookEventHandler.java',
        additions: 76,
        deletions: 10,
        coverage: 91,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 12, type: 'context', content: '@RestController' },
          { lineNumber: 13, type: 'delete', content: '@RequestMapping("/webhook")' },
          { lineNumber: 14, type: 'add', content: '@RequestMapping("/api/webhooks")' },
          { lineNumber: 15, type: 'context', content: 'public class WebhookEventHandler {' },
          { lineNumber: 16, type: 'context', content: '' },
          { lineNumber: 17, type: 'context', content: '  private final ScmWebhookProcessor processor;' },
          { lineNumber: 18, type: 'context', content: '' },
          { lineNumber: 19, type: 'delete', content: '  @PostMapping' },
          { lineNumber: 20, type: 'add', content: '  @PostMapping("/github")' },
          { lineNumber: 21, type: 'delete', content: '  public ResponseEntity<Void> handleWebhook(@RequestBody WebhookPayload payload) {' },
          { lineNumber: 22, type: 'add', content: '  public ResponseEntity<Void> handleGitHubWebhook(' },
          { lineNumber: 23, type: 'add', content: '      @RequestBody WebhookPayload payload,' },
          { lineNumber: 24, type: 'add', content: '      @RequestHeader("X-Hub-Signature-256") String signature) {' },
          { lineNumber: 25, type: 'add', content: '    ' },
          { lineNumber: 26, type: 'context', content: '    try {' },
          { lineNumber: 27, type: 'delete', content: '      processor.processWebhook(payload);' },
          { lineNumber: 28, type: 'add', content: '      processor.processWebhook(payload, signature);' },
          { lineNumber: 29, type: 'context', content: '      return ResponseEntity.ok().build();' },
          { lineNumber: 30, type: 'delete', content: '    } catch (Exception e) {' },
          { lineNumber: 31, type: 'add', content: '    } catch (InvalidWebhookSignatureException e) {' },
          { lineNumber: 32, type: 'add', content: '      log.warn("Invalid webhook signature", e);' },
          { lineNumber: 33, type: 'add', content: '      return ResponseEntity.status(401).build();' },
          { lineNumber: 34, type: 'add', content: '    } catch (Exception e) {' },
          { lineNumber: 35, type: 'add', content: '      log.error("Webhook processing failed", e);' },
          { lineNumber: 36, type: 'context', content: '      return ResponseEntity.status(500).build();' },
          { lineNumber: 37, type: 'context', content: '    }' },
          { lineNumber: 38, type: 'context', content: '  }' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/test/java/io/sonarcloud/analysis/AnalysisServiceTest.java',
        additions: 98,
        deletions: 0,
        coverage: 100,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.analysis;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import org.junit.jupiter.api.Test;' },
          { lineNumber: 4, type: 'add', content: 'import org.junit.jupiter.api.extension.ExtendWith;' },
          { lineNumber: 5, type: 'add', content: 'import org.mockito.InjectMocks;' },
          { lineNumber: 6, type: 'add', content: 'import org.mockito.Mock;' },
          { lineNumber: 7, type: 'add', content: 'import org.mockito.junit.jupiter.MockitoExtension;' },
          { lineNumber: 8, type: 'add', content: '' },
          { lineNumber: 9, type: 'add', content: 'import static org.mockito.Mockito.*;' },
          { lineNumber: 10, type: 'add', content: '' },
          { lineNumber: 11, type: 'add', content: '@ExtendWith(MockitoExtension.class)' },
          { lineNumber: 12, type: 'add', content: 'class AnalysisServiceTest {' },
          { lineNumber: 13, type: 'add', content: '' },
          { lineNumber: 14, type: 'add', content: '  @Mock' },
          { lineNumber: 15, type: 'add', content: '  private AnalysisClient analysisClient;' },
          { lineNumber: 16, type: 'add', content: '' },
          { lineNumber: 17, type: 'add', content: '  @Mock' },
          { lineNumber: 18, type: 'add', content: '  private WebhookEventPublisher eventPublisher;' },
          { lineNumber: 19, type: 'add', content: '' },
          { lineNumber: 20, type: 'add', content: '  @InjectMocks' },
          { lineNumber: 21, type: 'add', content: '  private AnalysisServiceImpl service;' },
          { lineNumber: 22, type: 'add', content: '' },
          { lineNumber: 23, type: 'add', content: '  @Test' },
          { lineNumber: 24, type: 'add', content: '  void testRunAnalysis_TriggersClient() {' },
          { lineNumber: 25, type: 'add', content: '    service.runAnalysis("project-key", "main");' },
          { lineNumber: 26, type: 'add', content: '    verify(analysisClient).triggerAnalysis("project-key", "main");' },
          { lineNumber: 27, type: 'add', content: '  }' },
          { lineNumber: 28, type: 'add', content: '' },
          { lineNumber: 29, type: 'add', content: '  @Test' },
          { lineNumber: 30, type: 'add', content: '  void testRunPrAnalysis_PublishesEvents() {' },
          { lineNumber: 31, type: 'add', content: '    service.runPrAnalysis("project-key", 42);' },
          { lineNumber: 32, type: 'add', content: '    verify(eventPublisher).publishPrAnalysisStarted("project-key", 42);' },
          { lineNumber: 33, type: 'add', content: '  }' },
          { lineNumber: 34, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/test/java/io/sonarcloud/webhook/ScmWebhookProcessorTest.java',
        additions: 72,
        deletions: 0,
        coverage: 100,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.webhook;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import org.junit.jupiter.api.Test;' },
          { lineNumber: 4, type: 'add', content: 'import org.mockito.Mock;' },
          { lineNumber: 5, type: 'add', content: '' },
          { lineNumber: 6, type: 'add', content: 'import static org.junit.jupiter.api.Assertions.*;' },
          { lineNumber: 7, type: 'add', content: 'import static org.mockito.Mockito.*;' },
          { lineNumber: 8, type: 'add', content: '' },
          { lineNumber: 9, type: 'add', content: 'class ScmWebhookProcessorTest {' },
          { lineNumber: 10, type: 'add', content: '' },
          { lineNumber: 11, type: 'add', content: '  @Mock' },
          { lineNumber: 12, type: 'add', content: '  private AnalysisService analysisService;' },
          { lineNumber: 13, type: 'add', content: '' },
          { lineNumber: 14, type: 'add', content: '  @Mock' },
          { lineNumber: 15, type: 'add', content: '  private WebhookSignatureValidator signatureValidator;' },
          { lineNumber: 16, type: 'add', content: '' },
          { lineNumber: 17, type: 'add', content: '  @Test' },
          { lineNumber: 18, type: 'add', content: '  void testProcessWebhook_ValidSignature() {' },
          { lineNumber: 19, type: 'add', content: '    WebhookPayload payload = new WebhookPayload();' },
          { lineNumber: 20, type: 'add', content: '    when(signatureValidator.isValid(any(), anyString())).thenReturn(true);' },
          { lineNumber: 21, type: 'add', content: '    // Test processing...' },
          { lineNumber: 22, type: 'add', content: '  }' },
          { lineNumber: 23, type: 'add', content: '' },
          { lineNumber: 24, type: 'add', content: '  @Test' },
          { lineNumber: 25, type: 'add', content: '  void testProcessWebhook_InvalidSignature_ThrowsException() {' },
          { lineNumber: 26, type: 'add', content: '    WebhookPayload payload = new WebhookPayload();' },
          { lineNumber: 27, type: 'add', content: '    when(signatureValidator.isValid(any(), anyString())).thenReturn(false);' },
          { lineNumber: 28, type: 'add', content: '    assertThrows(InvalidWebhookSignatureException.class, () -> {' },
          { lineNumber: 29, type: 'add', content: '      processor.processWebhook(payload, "invalid-sig");' },
          { lineNumber: 30, type: 'add', content: '    });' },
          { lineNumber: 31, type: 'add', content: '  }' },
          { lineNumber: 32, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
    ]
  },
  {
    groupId: 'integration',
    groupName: 'Integration Tests & E2E Workflow Tests',
    fileCount: 5,
    additions: 687,
    deletions: 23,
    needsReview: true,
    description: 'Added end-to-end integration tests covering the complete PR review workflow from webhook receipt to comment posting. Includes test fixtures with sample GitHub API responses.',
    reviewFocus: 'Ensure integration tests cover happy paths and error scenarios. Verify test data accurately reflects real GitHub API responses.',
    files: [
      {
        filename: 'src/test/java/io/sonarcloud/github/GitHubIntegrationTest.java',
        additions: 234,
        deletions: 8,
        coverage: 100,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.integration;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import org.junit.jupiter.api.Test;' },
          { lineNumber: 4, type: 'add', content: 'import org.springframework.boot.test.context.SpringBootTest;' },
          { lineNumber: 5, type: 'add', content: 'import org.springframework.test.context.ActiveProfiles;' },
          { lineNumber: 6, type: 'add', content: '' },
          { lineNumber: 7, type: 'add', content: '@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)' },
          { lineNumber: 8, type: 'add', content: '@ActiveProfiles("test")' },
          { lineNumber: 9, type: 'add', content: 'class GitHubIntegrationTest {' },
          { lineNumber: 10, type: 'add', content: '' },
          { lineNumber: 11, type: 'add', content: '  @Test' },
          { lineNumber: 12, type: 'add', content: '  void testPostCommentToRealPR() {' },
          { lineNumber: 13, type: 'add', content: '    // Integration test with real GitHub API' },
          { lineNumber: 14, type: 'add', content: '    String owner = "sonar-test";' },
          { lineNumber: 15, type: 'add', content: '    String repo = "test-repo";' },
          { lineNumber: 16, type: 'add', content: '    int prNumber = 1;' },
          { lineNumber: 17, type: 'add', content: '    ' },
          { lineNumber: 18, type: 'add', content: '    PostPrReviewCommentRequestDto request = new PostPrReviewCommentRequestDto();' },
          { lineNumber: 19, type: 'add', content: '    request.setBody("Test comment from integration test");' },
          { lineNumber: 20, type: 'add', content: '    request.setPath("src/main/java/Example.java");' },
          { lineNumber: 21, type: 'add', content: '    request.setPosition(10);' },
          { lineNumber: 22, type: 'add', content: '    ' },
          { lineNumber: 23, type: 'add', content: '    GitHubPrReviewCommentDto response = service.postComment(owner, repo, prNumber, request);' },
          { lineNumber: 24, type: 'add', content: '    assertNotNull(response);' },
          { lineNumber: 25, type: 'add', content: '    assertEquals(request.getBody(), response.getBody());' },
          { lineNumber: 26, type: 'add', content: '  }' },
          { lineNumber: 27, type: 'add', content: '' },
          { lineNumber: 28, type: 'add', content: '  @Test' },
          { lineNumber: 29, type: 'add', content: '  void testRateLimitHandling() {' },
          { lineNumber: 30, type: 'add', content: '    // Test rate limit behavior' },
          { lineNumber: 31, type: 'add', content: '  }' },
          { lineNumber: 32, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/test/java/io/sonarcloud/E2EWorkflowTest.java',
        additions: 298,
        deletions: 12,
        coverage: 100,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.integration;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import org.junit.jupiter.api.Test;' },
          { lineNumber: 4, type: 'add', content: 'import org.springframework.boot.test.context.SpringBootTest;' },
          { lineNumber: 5, type: 'add', content: '' },
          { lineNumber: 6, type: 'add', content: '@SpringBootTest' },
          { lineNumber: 7, type: 'add', content: 'class E2EWorkflowTest {' },
          { lineNumber: 8, type: 'add', content: '' },
          { lineNumber: 9, type: 'add', content: '  @Test' },
          { lineNumber: 10, type: 'add', content: '  void testCompleteWorkflow_WebhookToComment() {' },
          { lineNumber: 11, type: 'add', content: '    // 1. Receive webhook' },
          { lineNumber: 12, type: 'add', content: '    WebhookPayload webhook = loadWebhookPayload();' },
          { lineNumber: 13, type: 'add', content: '    webhookHandler.handleGitHubWebhook(webhook, "valid-signature");' },
          { lineNumber: 14, type: 'add', content: '    ' },
          { lineNumber: 15, type: 'add', content: '    // 2. Verify analysis triggered' },
          { lineNumber: 16, type: 'add', content: '    await().atMost(5, SECONDS).until(() -> analysisTriggered);' },
          { lineNumber: 17, type: 'add', content: '    ' },
          { lineNumber: 18, type: 'add', content: '    // 3. Verify comment posted' },
          { lineNumber: 19, type: 'add', content: '    verify(gitHubClient, timeout(10000)).postComment(any(), any(), anyInt(), any());' },
          { lineNumber: 20, type: 'add', content: '  }' },
          { lineNumber: 21, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/test/java/io/sonarcloud/PrReviewFlowTest.java',
        additions: 123,
        deletions: 3,
        coverage: 100,
        duplications: 0,
        issues: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: 'package com.sonar.integration;' },
          { lineNumber: 2, type: 'add', content: '' },
          { lineNumber: 3, type: 'add', content: 'import org.junit.jupiter.api.Test;' },
          { lineNumber: 4, type: 'add', content: '' },
          { lineNumber: 5, type: 'add', content: 'class PrReviewFlowTest {' },
          { lineNumber: 6, type: 'add', content: '' },
          { lineNumber: 7, type: 'add', content: '  @Test' },
          { lineNumber: 8, type: 'add', content: '  void testPrReviewFlow_FromAnalysisToComment() {' },
          { lineNumber: 9, type: 'add', content: '    // Test the flow from analysis completion to PR comment' },
          { lineNumber: 10, type: 'add', content: '    String projectKey = "test-project";' },
          { lineNumber: 11, type: 'add', content: '    int prNumber = 42;' },
          { lineNumber: 12, type: 'add', content: '    ' },
          { lineNumber: 13, type: 'add', content: '    // Trigger analysis' },
          { lineNumber: 14, type: 'add', content: '    analysisService.runPrAnalysis(projectKey, prNumber);' },
          { lineNumber: 15, type: 'add', content: '    ' },
          { lineNumber: 16, type: 'add', content: '    // Wait for completion and verify comment' },
          { lineNumber: 17, type: 'add', content: '  }' },
          { lineNumber: 18, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/test/resources/fixtures/pr-review-response.json',
        additions: 18,
        deletions: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: '{' },
          { lineNumber: 2, type: 'add', content: '  "id": 123456789,' },
          { lineNumber: 3, type: 'add', content: '  "body": "Test review comment",' },
          { lineNumber: 4, type: 'add', content: '  "path": "src/main/java/Example.java",' },
          { lineNumber: 5, type: 'add', content: '  "position": 10,' },
          { lineNumber: 6, type: 'add', content: '  "created_at": "2024-01-15T10:30:00Z",' },
          { lineNumber: 7, type: 'add', content: '  "user": {' },
          { lineNumber: 8, type: 'add', content: '    "login": "sonarqube-bot"' },
          { lineNumber: 9, type: 'add', content: '  }' },
          { lineNumber: 10, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
      {
        filename: 'src/test/resources/fixtures/webhook-payload.json',
        additions: 14,
        deletions: 0,
        changes: [
          { lineNumber: 1, type: 'add', content: '{' },
          { lineNumber: 2, type: 'add', content: '  "action": "opened",' },
          { lineNumber: 3, type: 'add', content: '  "pull_request": {' },
          { lineNumber: 4, type: 'add', content: '    "number": 42,' },
          { lineNumber: 5, type: 'add', content: '    "title": "Add new feature",' },
          { lineNumber: 6, type: 'add', content: '    "head": {' },
          { lineNumber: 7, type: 'add', content: '      "sha": "abc123def456"' },
          { lineNumber: 8, type: 'add', content: '    }' },
          { lineNumber: 9, type: 'add', content: '  }' },
          { lineNumber: 10, type: 'add', content: '}' },
        ],
        expanded: false,
        checked: false
      },
    ]
  },
];
